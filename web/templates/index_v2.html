<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIè§†é¢‘ç”Ÿæˆå¹³å°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            height: 100vh;
        }
        
        /* å·¦ä¾§æ  - é¡¹ç›®ç»“æ„ */
        .left-sidebar {
            width: 280px;
            background: #252525;
            border-right: 1px solid #333;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .sidebar-header h3 {
            font-size: 16px;
            font-weight: 500;
        }
        
        .new-project-btn {
            width: 100%;
            padding: 4px;
            margin-top: 6px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 11px;
            height: 28px;
        }
        
        .new-project-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .project-list {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }
        
        .project-item {
            margin-bottom: 10px;
            background: #2a2a2a;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .project-item.active {
            background: #333;
            box-shadow: 0 2px 4px rgba(102,126,234,0.3);
        }
        
        .project-header {
            padding: 12px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .project-header:hover {
            background: #333;
        }
        
        .project-name {
            font-weight: 500;
            color: #e0e0e0;
        }
        
        .project-arrow {
            transition: transform 0.3s;
            color: #666;
        }
        
        .project-item.expanded .project-arrow {
            transform: rotate(90deg);
        }
        
        .project-tree {
            display: none;
            padding: 0 12px 12px 24px;
        }
        
        .project-item.expanded .project-tree {
            display: block;
        }
        
        .tree-node {
            padding: 4px 0;
            cursor: pointer;
            color: #999;
            font-size: 13px;
        }
        
        .tree-node:hover {
            color: #667eea;
        }
        
        .tree-folder {
            font-weight: 500;
            color: #b0b0b0;
            margin: 4px 0 2px 0;
            font-size: 12px;
            line-height: 1.3;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 3px;
        }
        
        .tree-folder:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .tree-file {
            padding-left: 16px;
            position: relative;
            font-size: 11px;
            line-height: 1.3;
            color: #888;
            cursor: pointer;
            margin: 1px 0;
            padding: 2px 4px 2px 16px;
            border-radius: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tree-file:hover {
            background: rgba(255,255,255,0.1);
            color: #e0e0e0;
        }
        
        .tree-file::before {
            content: 'â€¢';
            position: absolute;
            left: 6px;
            color: #555;
            font-size: 10px;
        }
        
        .file-count {
            color: #666;
            font-size: 10px;
            margin-left: 4px;
        }
        
        /* ä¸­é—´æ  - æ§åˆ¶é¢æ¿ */
        .main-content {
            flex: 1;
            background: #1e1e1e;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .control-tabs {
            display: flex;
            background: #2a2a2a;
            border-bottom: 1px solid #333;
            padding: 0 20px;
        }
        
        .control-tab {
            padding: 15px 20px;
            cursor: pointer;
            color: #999;
            border-bottom: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .control-tab:hover {
            color: #e0e0e0;
        }
        
        .control-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }
        
        .control-panel {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .panel-section {
            display: none;
        }
        
        .panel-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #b0b0b0;
            font-size: 14px;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: #333;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }
        
        .param-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .param-col {
            flex: 1;
        }
        
        .param-col label {
            display: block;
            margin-bottom: 5px;
            color: #b0b0b0;
            font-size: 12px;
            font-weight: 500;
        }
        
        .param-col input,
        .param-col select {
            width: 100%;
            padding: 8px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: #e0e0e0;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102,126,234,0.4);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: #3a3a3a;
        }
        
        .btn-secondary:hover {
            background: #444;
        }
        
        .model-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .model-option {
            flex: 1;
            padding: 12px;
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s;
        }
        
        .model-option:hover {
            border-color: #555;
        }
        
        .model-option.selected {
            border-color: #667eea;
            background: #333;
        }
        
        /* å³ä¾§æ  - é¢„è§ˆé¢æ¿ */
        .right-sidebar {
            width: 400px;
            background: #252525;
            border-left: 1px solid #333;
            display: flex;
            flex-direction: column;
        }
        
        .preview-header {
            padding: 20px;
            background: #2a2a2a;
            border-bottom: 1px solid #333;
        }
        
        .preview-header h3 {
            font-size: 16px;
            color: #e0e0e0;
        }
        
        .preview-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .preview-empty {
            color: #666;
            text-align: center;
            margin-top: 50px;
        }
        
        .preview-image {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .preview-video {
            width: 100%;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .preview-json {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            line-height: 1.5;
            color: #b0b0b0;
            overflow-x: auto;
        }
        
        .preview-text {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            color: #e0e0e0;
            line-height: 1.6;
        }
        
        .preview-title {
            font-size: 14px;
            color: #667eea;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }
        
        .preview-meta {
            font-size: 12px;
            color: #666;
            margin-bottom: 15px;
        }
        
        /* çŠ¶æ€æ  */
        .status-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 30px;
            background: #1a1a1a;
            border-top: 1px solid #333;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 100;
        }
        
        .status-text {
            color: #666;
            font-size: 12px;
        }
        
        .status-project {
            margin-left: auto;
            color: #667eea;
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #444;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Agentå’Œæ¨¡å‹çš„å­æ ‡ç­¾ */
        .sub-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
            padding-bottom: 10px;
        }
        
        .sub-tab {
            padding: 8px 16px;
            background: #2a2a2a;
            border-radius: 4px 4px 0 0;
            cursor: pointer;
            color: #999;
            transition: all 0.3s;
        }
        
        .sub-tab:hover {
            background: #333;
            color: #e0e0e0;
        }
        
        .sub-tab.active {
            background: #333;
            color: #667eea;
        }
        
        .result-display {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .result-display pre {
            color: #b0b0b0;
            font-size: 12px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* ä¸Šä¼ åŒºåŸŸæ ·å¼ */
        .upload-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }
        
        .upload-section h5 {
            font-size: 11px;
            margin: 0 0 6px 0;
            color: #bbb;
            font-weight: 500;
        }
        
        .upload-area {
            border: 1px dashed #555;
            border-radius: 4px;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #1a1a1a;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area:hover {
            border-color: #667eea;
            background: #222;
        }
        
        .upload-area.dragover {
            border-color: #667eea;
            background: #222;
        }
        
        .upload-icon {
            font-size: 16px;
            color: #888;
        }
        
        .upload-area:hover .upload-icon {
            color: #667eea;
        }
        
        /* ç´ æç½‘æ ¼æ ·å¼ */
        .assets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            padding: 20px;
        }
        
        .assets-empty {
            grid-column: 1 / -1;
            text-align: center;
            color: #666;
            padding: 40px 20px;
            font-size: 14px;
        }
        
        .asset-item {
            background: #2a2a2a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .asset-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .asset-preview {
            width: 100%;
            height: 80px;
            object-fit: cover;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 24px;
        }
        
        .asset-info {
            padding: 8px;
        }
        
        .asset-name {
            color: #e0e0e0;
            font-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .asset-type {
            color: #666;
            font-size: 10px;
            margin-top: 2px;
        }
        
        /* é‡å‘½åèœå•æ ·å¼ */
        .rename-menu {
            position: fixed;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 5px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 1000;
            min-width: 120px;
        }
        
        .rename-menu-item {
            padding: 8px 15px;
            cursor: pointer;
            color: #e0e0e0;
            font-size: 13px;
        }
        
        .rename-menu-item:hover {
            background: #333;
            color: #667eea;
        }
        
        .rename-input {
            background: #1a1a1a;
            border: 1px solid #667eea;
            color: #e0e0e0;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 12px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å·¦ä¾§æ ï¼šé¡¹ç›®ç»“æ„ -->
        <div class="left-sidebar">
            <div class="sidebar-header">
                <h3>ğŸ¬ é¡¹ç›®ç®¡ç†</h3>
                <button class="new-project-btn" onclick="createProject()">+ åˆ›å»ºæ–°é¡¹ç›®</button>
            </div>
            <div class="project-list" id="projectList">
                <!-- é¡¹ç›®åˆ—è¡¨åŠ¨æ€ç”Ÿæˆ -->
            </div>
            
            <!-- ä¸Šä¼ ç´ æåŒºåŸŸ -->
            <div class="upload-section">
                <h5>ğŸ“ ä¸Šä¼ ç´ æ</h5>
                <div class="upload-area" onclick="triggerFileUpload()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)">
                    <div class="upload-icon">+</div>
                    <div class="upload-text">ç‚¹å‡»æˆ–æ‹–æ‹½</div>
                </div>
                <input type="file" id="fileInput" multiple accept="image/*,video/*" style="display:none" onchange="handleFileUpload(event)">
            </div>
        </div>
        
        <!-- ä¸­é—´æ ï¼šæ§åˆ¶é¢æ¿ -->
        <div class="main-content">
            <div class="control-tabs">
                <div class="control-tab active" onclick="switchMainTab('agent')">Agentæ§åˆ¶</div>
                <div class="control-tab" onclick="switchMainTab('model')">æ¨¡å‹ç”Ÿæˆ</div>
                <div class="control-tab" onclick="switchMainTab('assets')">ç´ æç®¡ç†</div>
            </div>
            
            <div class="control-panel">
                <!-- Agentæ§åˆ¶åŒºåŸŸ -->
                <div id="agent-panel" class="panel-section active">
                    <div class="sub-tabs">
                        <div class="sub-tab active" onclick="switchSubTab('agent', 'story')">æ•…äº‹åˆ†æ</div>
                        <div class="sub-tab" onclick="switchSubTab('agent', 'storyboard')">åˆ†é•œè„šæœ¬</div>
                        <div class="sub-tab" onclick="switchSubTab('agent', 'character')">è§’è‰²è®¾è®¡</div>
                        <div class="sub-tab" onclick="switchSubTab('agent', 'scene')">åœºæ™¯è®¾è®¡</div>
                    </div>
                    
                    <!-- æ•…äº‹åˆ†æ -->
                    <div id="agent-story" class="agent-content active">
                        <div class="form-group">
                            <label>æ•…äº‹å†…å®¹</label>
                            <textarea id="storyInput" placeholder="è¾“å…¥ä½ çš„æ•…äº‹åˆ›æ„..."></textarea>
                        </div>
                        <button class="btn" onclick="executeAgent('story')">æ‰§è¡Œæ•…äº‹åˆ†æ</button>
                        <div class="result-display" id="storyResult" style="display:none;">
                            <pre></pre>
                        </div>
                    </div>
                    
                    <!-- åˆ†é•œè„šæœ¬ -->
                    <div id="agent-storyboard" class="agent-content" style="display:none;">
                        <div class="form-group">
                            <label>é€‰æ‹©æ•…äº‹åˆ†æç»“æœ</label>
                            <select id="storyAnalysisSelect">
                                <option value="">-- é€‰æ‹©å·²æœ‰çš„æ•…äº‹åˆ†æ --</option>
                            </select>
                        </div>
                        <button class="btn" onclick="executeAgent('storyboard')">ç”Ÿæˆåˆ†é•œè„šæœ¬</button>
                        <div class="result-display" id="storyboardResult" style="display:none;">
                            <pre></pre>
                        </div>
                    </div>
                    
                    <!-- è§’è‰²è®¾è®¡ -->
                    <div id="agent-character" class="agent-content" style="display:none;">
                        <div class="form-group">
                            <label>é€‰æ‹©æ•…äº‹åˆ†æç»“æœ</label>
                            <select id="storyAnalysisForCharacter">
                                <option value="">-- é€‰æ‹©å·²æœ‰çš„æ•…äº‹åˆ†æ --</option>
                            </select>
                        </div>
                        <button class="btn" onclick="executeAgent('character')">è®¾è®¡è§’è‰²</button>
                        <div class="result-display" id="characterResult" style="display:none;">
                            <pre></pre>
                        </div>
                    </div>
                    
                    <!-- åœºæ™¯è®¾è®¡ -->
                    <div id="agent-scene" class="agent-content" style="display:none;">
                        <p style="color: #666;">åœºæ™¯è®¾è®¡Agentå¼€å‘ä¸­...</p>
                    </div>
                </div>
                
                <!-- æ¨¡å‹ç”ŸæˆåŒºåŸŸ -->
                <div id="model-panel" class="panel-section">
                    <div class="sub-tabs">
                        <div class="sub-tab active" onclick="switchSubTab('model', 't2i')">æ–‡ç”Ÿå›¾</div>
                        <div class="sub-tab" onclick="switchSubTab('model', 'i2v')">å›¾ç”Ÿè§†é¢‘</div>
                        <div class="sub-tab" onclick="switchSubTab('model', 't2v')">æ–‡ç”Ÿè§†é¢‘</div>
                        <div class="sub-tab" onclick="switchSubTab('model', 'kf')">é¦–å°¾å¸§</div>
                        <div class="sub-tab" onclick="switchSubTab('model', 'edit')">å›¾ç‰‡ç¼–è¾‘</div>
                    </div>
                    
                    <!-- æ–‡ç”Ÿå›¾ -->
                    <div id="model-t2i" class="model-content active">
                        <div class="form-group">
                            <label>Prompt</label>
                            <textarea id="t2i-prompt" placeholder="æè¿°ä½ æƒ³ç”Ÿæˆçš„å›¾åƒ..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Negative Prompt</label>
                            <input type="text" id="t2i-negative" placeholder="ä¸å¸Œæœ›å‡ºç°çš„å†…å®¹..." />
                        </div>
                        <div class="param-row">
                            <div class="param-col">
                                <label>åˆ†è¾¨ç‡</label>
                                <select id="t2i-size">
                                    <option value="1920*1080" selected>1920Ã—1080 (16:9)</option>
                                    <option value="1080*1920">1080Ã—1920 (9:16)</option>
                                    <option value="1440*1440">1440Ã—1440 (1:1)</option>
                                    <option value="1632*1248">1632Ã—1248 (4:3)</option>
                                    <option value="1248*1632">1248Ã—1632 (3:4)</option>
                                </select>
                            </div>
                            <div class="param-col">
                                <label>é£æ ¼</label>
                                <select id="t2i-style">
                                    <option value="auto" selected>è‡ªåŠ¨</option>
                                    <option value="realistic">å†™å®</option>
                                    <option value="cartoon">å¡é€š</option>
                                    <option value="anime">åŠ¨æ¼«</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="generateContent('text-to-image')">ç”Ÿæˆå›¾åƒ</button>
                    </div>
                    
                    <!-- å›¾ç”Ÿè§†é¢‘ -->
                    <div id="model-i2v" class="model-content" style="display:none;">
                        <div class="form-group">
                            <label>é€‰æ‹©å›¾åƒ</label>
                            <select id="i2v-image">
                                <option value="">-- é€‰æ‹©é¡¹ç›®ä¸­çš„å›¾åƒ --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>åŠ¨æ€æè¿°</label>
                            <textarea id="i2v-prompt" placeholder="æè¿°åŠ¨æ€æ•ˆæœ..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Negative Prompt</label>
                            <input type="text" id="i2v-negative" placeholder="ä¸å¸Œæœ›å‡ºç°çš„å†…å®¹..." />
                        </div>
                        <div class="param-row">
                            <div class="param-col">
                                <label>åˆ†è¾¨ç‡</label>
                                <select id="i2v-resolution">
                                    <option value="1280*720" selected>1280Ã—720 (16:9)</option>
                                    <option value="1920*1080">1920Ã—1080 (16:9)</option>
                                    <option value="720*1280">720Ã—1280 (9:16)</option>
                                </select>
                            </div>
                            <div class="param-col">
                                <label>æ—¶é•¿(ç§’)</label>
                                <select id="i2v-duration">
                                    <option value="5" selected>5ç§’</option>
                                    <option value="10">10ç§’</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="generateContent('image-to-video')">ç”Ÿæˆè§†é¢‘</button>
                    </div>
                    
                    <!-- æ–‡ç”Ÿè§†é¢‘ -->
                    <div id="model-t2v" class="model-content" style="display:none;">
                        <div class="form-group">
                            <label>é€‰æ‹©æ¨¡å‹</label>
                            <div class="model-selector">
                                <div class="model-option selected" onclick="selectModel('t2v', 'wanx-t2v-plus', this); updateT2VResolutions('online')">
                                    é€šä¹‰ä¸‡ç›¸ Plus
                                </div>
                                <div class="model-option" onclick="selectModel('t2v', 'local-t2v', this); updateT2VResolutions('local')">
                                    æœ¬åœ°æ¨¡å‹
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Prompt</label>
                            <textarea id="t2v-prompt" placeholder="æè¿°ä½ æƒ³ç”Ÿæˆçš„è§†é¢‘..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Negative Prompt</label>
                            <input type="text" id="t2v-negative" placeholder="ä¸å¸Œæœ›å‡ºç°çš„å†…å®¹..." />
                        </div>
                        <div class="param-row">
                            <div class="param-col">
                                <label>åˆ†è¾¨ç‡</label>
                                <select id="t2v-resolution">
                                    <option value="1920*1088" selected>1920Ã—1088 (16:9)</option>
                                    <option value="1088*1920">1088Ã—1920 (9:16)</option>
                                    <option value="1280*704">1280Ã—704 (16:9)</option>
                                    <option value="1024*1024">1024Ã—1024 (1:1)</option>
                                    <option value="768*1344">768Ã—1344 (9:16)</option>
                                    <option value="1344*768">1344Ã—768 (16:9)</option>
                                </select>
                            </div>
                            <div class="param-col">
                                <label>æ—¶é•¿(ç§’)</label>
                                <select id="t2v-duration">
                                    <option value="5" selected>5ç§’</option>
                                    <option value="10">10ç§’</option>
                                </select>
                            </div>
                        </div>
                        <div class="param-row">
                            <div class="param-col">
                                <label>é£æ ¼</label>
                                <select id="t2v-style">
                                    <option value="realistic" selected>å†™å®</option>
                                    <option value="cartoon">å¡é€š</option>
                                    <option value="anime">åŠ¨æ¼«</option>
                                </select>
                            </div>
                            <div class="param-col">
                                <label>è¿åŠ¨å¼ºåº¦</label>
                                <select id="t2v-motion">
                                    <option value="0.3">ä½ (0.3)</option>
                                    <option value="0.5" selected>ä¸­ (0.5)</option>
                                    <option value="0.7">é«˜ (0.7)</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn" onclick="generateContent('text-to-video')">ç”Ÿæˆè§†é¢‘</button>
                    </div>
                    
                    <!-- é¦–å°¾å¸§ -->
                    <div id="model-kf" class="model-content" style="display:none;">
                        <div class="form-group">
                            <label>é¦–å¸§å›¾åƒ</label>
                            <select id="kf-first">
                                <option value="">-- é€‰æ‹©é¦–å¸§ --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å°¾å¸§å›¾åƒ</label>
                            <select id="kf-last">
                                <option value="">-- é€‰æ‹©å°¾å¸§ --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>è¿‡æ¸¡æè¿°</label>
                            <textarea id="kf-prompt" placeholder="æè¿°è¿‡æ¸¡æ•ˆæœ..."></textarea>
                        </div>
                        <button class="btn" onclick="generateContent('keyframe-video')">ç”Ÿæˆè§†é¢‘</button>
                    </div>
                    
                    <!-- å›¾ç‰‡ç¼–è¾‘ -->
                    <div id="model-edit" class="model-content" style="display:none;">
                        <div class="form-group">
                            <label>é€‰æ‹©å›¾åƒ</label>
                            <select id="edit-image">
                                <option value="">-- é€‰æ‹©è¦ç¼–è¾‘çš„å›¾åƒ --</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç¼–è¾‘æŒ‡ä»¤</label>
                            <textarea id="edit-instruction" placeholder="æè¿°ç¼–è¾‘éœ€æ±‚..."></textarea>
                        </div>
                        <button class="btn" onclick="generateContent('image-edit')">ç¼–è¾‘å›¾åƒ</button>
                    </div>
                </div>
                
                <!-- ç´ æç®¡ç†åŒºåŸŸ -->
                <div id="assets-panel" class="panel-section">
                    <div class="assets-grid" id="assetsGrid">
                        <div class="assets-empty">
                            è¯·é€‰æ‹©é¡¹ç›®æŸ¥çœ‹ç´ æ
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- å³ä¾§æ ï¼šé¢„è§ˆé¢æ¿ -->
        <div class="right-sidebar">
            <div class="preview-header">
                <h3>é¢„è§ˆ</h3>
            </div>
            <div class="preview-content" id="previewContent">
                <div class="preview-empty">
                    ç‚¹å‡»å·¦ä¾§æ–‡ä»¶æˆ–ç”Ÿæˆå†…å®¹åé¢„è§ˆ
                </div>
            </div>
        </div>
    </div>
    
    <!-- çŠ¶æ€æ  -->
    <div class="status-bar">
        <span class="status-text" id="statusText">å°±ç»ª</span>
        <span class="status-project" id="statusProject">æœªé€‰æ‹©é¡¹ç›®</span>
    </div>
    
    <script>
        let currentProject = null;
        let selectedModels = {
            't2v': 'wanx-t2v-plus'
        };
        
        // åˆå§‹åŒ–
        window.onload = function() {
            loadProjects();
        };
        
        // åŠ è½½é¡¹ç›®åˆ—è¡¨
        function loadProjects() {
            fetch('/api/projects')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const projectList = document.getElementById('projectList');
                        projectList.innerHTML = '';
                        
                        data.projects.forEach(project => {
                            const projectDiv = createProjectElement(project);
                            projectList.appendChild(projectDiv);
                        });
                    }
                });
        }
        
        // åˆ›å»ºé¡¹ç›®å…ƒç´ 
        function createProjectElement(project) {
            const div = document.createElement('div');
            div.className = 'project-item';
            div.id = `project-${project.id}`;
            
            div.innerHTML = `
                <div class="project-header" onclick="toggleProject('${project.id}')">
                    <div>
                        <div class="project-name">${project.name}</div>
                    </div>
                    <span class="project-arrow">â–¶</span>
                </div>
                <div class="project-tree" id="tree-${project.id}">
                    <!-- é¡¹ç›®ç»“æ„å°†åœ¨å±•å¼€æ—¶åŠ è½½ -->
                </div>
            `;
            
            return div;
        }
        
        // åˆ‡æ¢é¡¹ç›®å±•å¼€/æ”¶èµ·
        function toggleProject(projectId) {
            const projectItem = document.getElementById(`project-${projectId}`);
            const isExpanded = projectItem.classList.contains('expanded');
            
            // æ”¶èµ·æ‰€æœ‰å…¶ä»–é¡¹ç›®
            document.querySelectorAll('.project-item').forEach(item => {
                item.classList.remove('expanded', 'active');
            });
            
            if (!isExpanded) {
                // å±•å¼€å½“å‰é¡¹ç›®
                projectItem.classList.add('expanded', 'active');
                selectProject(projectId);
                loadProjectStructure(projectId);
            }
        }
        
        // é€‰æ‹©é¡¹ç›®
        function selectProject(projectId) {
            fetch(`/api/projects/${projectId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentProject = data.project;
                        document.getElementById('statusProject').textContent = `å½“å‰é¡¹ç›®: ${currentProject.name}`;
                        loadAvailablePrompts();
                    }
                });
        }
        
        // åŠ è½½é¡¹ç›®ç»“æ„
        function loadProjectStructure(projectId) {
            fetch(`/api/projects/${projectId}/structure`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const treeDiv = document.getElementById(`tree-${projectId}`);
                        treeDiv.innerHTML = generateTreeHTML(data.structure, projectId);
                        updateAssetSelectors(data.structure);
                    }
                });
        }
        
        // ç”Ÿæˆæ ‘å½¢ç»“æ„HTML
        function generateTreeHTML(structure, projectId) {
            let html = '';
            
            // Assets
            html += '<div class="tree-folder">ğŸ“ ç´ æ</div>';
            if (structure.assets.images.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">ğŸ–¼ å›¾ç‰‡ <span class="file-count">(${structure.assets.images.length})</span></div>`;
                structure.assets.images.forEach(img => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'image', 'assets/images/${img}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'assets/images/${img}', '${img}')">${img}</div>`;
                });
            }
            if (structure.assets.videos.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">ğŸ¬ è§†é¢‘ <span class="file-count">(${structure.assets.videos.length})</span></div>`;
                structure.assets.videos.forEach(vid => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'video', 'assets/videos/${vid}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'assets/videos/${vid}', '${vid}')">${vid}</div>`;
                });
            }
            if (structure.assets.audios.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">ğŸµ éŸ³é¢‘ <span class="file-count">(${structure.assets.audios.length})</span></div>`;
                structure.assets.audios.forEach(aud => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'audio', 'assets/audios/${aud}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'assets/audios/${aud}', '${aud}')">${aud}</div>`;
                });
            }
            
            // Prompts
            html += '<div class="tree-folder">ğŸ“ Prompts</div>';
            ['story', 'storyboard', 'characters', 'scenes', 'shots', 'videos'].forEach(type => {
                if (structure.prompts[type].length > 0) {
                    const typeName = {story: 'æ•…äº‹', storyboard: 'åˆ†é•œ', characters: 'è§’è‰²', scenes: 'åœºæ™¯', shots: 'é•œå¤´', videos: 'è§†é¢‘'}[type];
                    html += `<div class="tree-folder" style="padding-left:12px">${typeName} <span class="file-count">(${structure.prompts[type].length})</span></div>`;
                    structure.prompts[type].forEach(file => {
                        html += `<div class="tree-file" onclick="previewPrompt('${projectId}', '${type}', '${file}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'prompts/${type}/${file}', '${file}')">${file}</div>`;
                    });
                }
            });
            
            // Outputs
            html += '<div class="tree-folder">ğŸ“¤ è¾“å‡º</div>';
            if (structure.outputs.references.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">å‚è€ƒå›¾ <span class="file-count">(${structure.outputs.references.length})</span></div>`;
                structure.outputs.references.forEach(img => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'image', 'outputs/references/${img}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'outputs/references/${img}', '${img}')">${img}</div>`;
                });
            }
            if (structure.outputs.storyboards.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">æ•…äº‹æ¿ <span class="file-count">(${structure.outputs.storyboards.length})</span></div>`;
                structure.outputs.storyboards.forEach(sb => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'image', 'outputs/storyboards/${sb}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'outputs/storyboards/${sb}', '${sb}')">${sb}</div>`;
                });
            }
            if (structure.outputs.videos.length > 0) {
                html += `<div class="tree-folder" style="padding-left:12px">è§†é¢‘ <span class="file-count">(${structure.outputs.videos.length})</span></div>`;
                structure.outputs.videos.forEach(vid => {
                    html += `<div class="tree-file" onclick="previewFile('${projectId}', 'video', 'outputs/videos/${vid}')" oncontextmenu="showRenameMenu(event, '${projectId}', 'outputs/videos/${vid}', '${vid}')">${vid}</div>`;
                });
            }
            
            return html;
        }
        
        // é¢„è§ˆæ–‡ä»¶  
        function previewFile(projectId, type, path) {
            const previewContent = document.getElementById('previewContent');
            const fullPath = `/projects/${projectId}/${path}`;
            
            console.log(`Previewing file ${type}: ${fullPath}`);
            
            if (type === 'image') {
                previewContent.innerHTML = `
                    <div class="preview-title">æ–‡ä»¶é¢„è§ˆ</div>
                    <img src="${fullPath}" style="max-width: 100%; border-radius: 4px;" onload="console.log('Image loaded')" onerror="console.error('Image failed to load:', this.src)" />
                    <div class="preview-meta">è·¯å¾„: ${path}</div>
                `;
            } else if (type === 'video') {
                previewContent.innerHTML = `
                    <div class="preview-title">æ–‡ä»¶é¢„è§ˆ</div>
                    <video src="${fullPath}" controls style="max-width: 100%; border-radius: 4px;" onloadeddata="console.log('Video loaded')" onerror="console.error('Video failed to load:', this.src)"></video>
                    <div class="preview-meta">è·¯å¾„: ${path}</div>
                `;
            }
        }
        
        // é¢„è§ˆPromptæ–‡ä»¶
        function previewPrompt(projectId, type, filename) {
            fetch(`/api/projects/${projectId}/file?path=prompts/${type}/${filename}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const previewContent = document.getElementById('previewContent');
                        previewContent.innerHTML = `
                            <div class="preview-title">Prompté¢„è§ˆ</div>
                            <div class="preview-meta">${filename}</div>
                            <pre style="background: #1a1a1a; padding: 15px; border-radius: 4px; max-height: 400px; overflow-y: auto; white-space: pre-wrap; font-size: 12px;">${JSON.stringify(data.content, null, 2)}</pre>
                        `;
                    }
                })
                .catch(error => {
                    console.error('Preview error:', error);
                });
        }
        
        // æ›´æ–°ç´ æé€‰æ‹©å™¨
        function updateAssetSelectors(structure) {
            // æ›´æ–°å›¾åƒé€‰æ‹©å™¨
            const imageSelectors = ['i2v-image', 'edit-image', 'kf-first', 'kf-last'];
            imageSelectors.forEach(id => {
                const select = document.getElementById(id);
                if (select) {
                    select.innerHTML = '<option value="">-- é€‰æ‹©å›¾åƒ --</option>';
                    structure.assets.images.forEach(img => {
                        select.innerHTML += `<option value="assets/images/${img}">${img}</option>`;
                    });
                    structure.outputs.references.forEach(img => {
                        select.innerHTML += `<option value="outputs/references/${img}">[è¾“å‡º] ${img}</option>`;
                    });
                }
            });
        }
        
        // åŠ è½½å¯ç”¨çš„prompts
        function loadAvailablePrompts() {
            if (!currentProject) return;
            
            fetch(`/api/projects/${currentProject.id}/prompts/story`)
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.prompts.length > 0) {
                        const selects = ['storyAnalysisSelect', 'storyAnalysisForCharacter'];
                        selects.forEach(id => {
                            const select = document.getElementById(id);
                            if (select) {
                                select.innerHTML = '<option value="">-- é€‰æ‹©æ•…äº‹åˆ†æ --</option>';
                                data.prompts.forEach(prompt => {
                                    select.innerHTML += `<option value='${JSON.stringify(prompt.content)}'>${prompt.filename}</option>`;
                                });
                            }
                        });
                    }
                });
        }
        
        // åˆ›å»ºæ–°é¡¹ç›®
        function createProject() {
            const name = prompt('é¡¹ç›®åç§°:');
            if (!name) return;
            
            const description = prompt('é¡¹ç›®æè¿°:');
            
            fetch('/api/projects', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ name, description })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    loadProjects();
                    setTimeout(() => {
                        toggleProject(data.project.id);
                    }, 100);
                }
            });
        }
        
        // åˆ‡æ¢ä¸»æ ‡ç­¾
        function switchMainTab(tab) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            document.querySelectorAll('.control-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // åˆ‡æ¢é¢æ¿
            document.querySelectorAll('.panel-section').forEach(p => p.classList.remove('active'));
            document.getElementById(`${tab}-panel`).classList.add('active');
            
            // å¦‚æœæ˜¯ç´ æç®¡ç†é¢æ¿ï¼ŒåŠ è½½ç´ æ
            if (tab === 'assets') {
                loadAssets();
            }
        }
        
        // ä¸Šä¼ ç›¸å…³å‡½æ•°
        function triggerFileUpload() {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                return;
            }
            document.getElementById('fileInput').click();
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }
        
        function handleFileDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                return;
            }
            
            const files = e.dataTransfer.files;
            uploadFiles(files);
        }
        
        function handleFileUpload(e) {
            const files = e.target.files;
            uploadFiles(files);
        }
        
        function uploadFiles(files) {
            if (!currentProject || !currentProject.id) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                return;
            }
            
            Array.from(files).forEach(file => {
                const formData = new FormData();
                formData.append('file', file);
                
                // åˆ¤æ–­æ–‡ä»¶ç±»å‹
                const isImage = file.type.startsWith('image/');
                const isVideo = file.type.startsWith('video/');
                
                if (!isImage && !isVideo) {
                    alert(`ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹: ${file.name}`);
                    return;
                }
                
                formData.append('type', isImage ? 'image' : 'video');
                
                document.getElementById('statusText').innerHTML = `ä¸Šä¼ ${file.name}ä¸­...<span class="loading"></span>`;
                
                fetch(`/api/projects/${currentProject.id}/assets`, {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('statusText').textContent = 'ä¸Šä¼ æˆåŠŸ';
                        loadAssets(); // åˆ·æ–°ç´ æåˆ—è¡¨
                        loadProjectStructure(currentProject.id); // åˆ·æ–°é¡¹ç›®ç»“æ„
                    } else {
                        document.getElementById('statusText').textContent = `ä¸Šä¼ å¤±è´¥: ${data.error}`;
                    }
                })
                .catch(error => {
                    document.getElementById('statusText').textContent = `ä¸Šä¼ é”™è¯¯: ${error}`;
                });
            });
        }
        
        // åŠ è½½ç´ æ
        function loadAssets() {
            if (!currentProject) {
                document.getElementById('assetsGrid').innerHTML = '<div class="assets-empty">è¯·é€‰æ‹©é¡¹ç›®æŸ¥çœ‹ç´ æ</div>';
                return;
            }
            
            fetch(`/api/projects/${currentProject.id}/structure`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayAssets(data.structure);
                    }
                });
        }
        
        function displayAssets(structure) {
            const grid = document.getElementById('assetsGrid');
            let html = '';
            
            const allAssets = [];
            
            // æ”¶é›†æ‰€æœ‰ç´ æ
            if (structure.assets.images) {
                structure.assets.images.forEach(img => {
                    allAssets.push({ name: img, type: 'image', path: `assets/images/${img}` });
                });
            }
            
            if (structure.assets.videos) {
                structure.assets.videos.forEach(vid => {
                    allAssets.push({ name: vid, type: 'video', path: `assets/videos/${vid}` });
                });
            }
            
            if (allAssets.length === 0) {
                grid.innerHTML = '<div class="assets-empty">æš‚æ— ç´ ææ–‡ä»¶</div>';
                return;
            }
            
            allAssets.forEach(asset => {
                const icon = asset.type === 'image' ? 'ğŸ–¼ï¸' : 'ğŸ¬';
                html += `
                    <div class="asset-item" onclick="previewAsset('${asset.path}', '${asset.type}')">
                        <div class="asset-preview">${icon}</div>
                        <div class="asset-info">
                            <div class="asset-name">${asset.name}</div>
                            <div class="asset-type">${asset.type}</div>
                        </div>
                    </div>
                `;
            });
            
            grid.innerHTML = html;
            
            // æ›´æ–°å›¾ç‰‡/è§†é¢‘é€‰æ‹©ä¸‹æ‹‰æ¡†
            updateAssetSelectors(structure);
        }
        
        function previewAsset(path, type) {
            const previewContent = document.getElementById('previewContent');
            const fullPath = `/projects/${currentProject.id}/${path}`;
            
            console.log(`Previewing ${type}: ${fullPath}`); // Debug log
            
            if (type === 'image') {
                previewContent.innerHTML = `
                    <div class="preview-title">ç´ æé¢„è§ˆ</div>
                    <img src="${fullPath}" style="max-width: 100%; border-radius: 4px;" onload="console.log('Image loaded')" onerror="console.error('Image failed to load:', this.src)" />
                    <div class="preview-meta">è·¯å¾„: ${path}</div>
                `;
            } else if (type === 'video') {
                previewContent.innerHTML = `
                    <div class="preview-title">ç´ æé¢„è§ˆ</div>
                    <video src="${fullPath}" controls style="max-width: 100%; border-radius: 4px;" onloadeddata="console.log('Video loaded')" onerror="console.error('Video failed to load:', this.src)"></video>
                    <div class="preview-meta">è·¯å¾„: ${path}</div>
                `;
            }
        }
        
        // æ›´æ–°ç´ æé€‰æ‹©å™¨
        function updateAssetSelectors(structure) {
            // æ›´æ–°å›¾ç”Ÿè§†é¢‘çš„å›¾ç‰‡é€‰æ‹©
            const i2vSelect = document.getElementById('i2v-image');
            if (i2vSelect) {
                i2vSelect.innerHTML = '<option value="">-- é€‰æ‹©é¡¹ç›®ä¸­çš„å›¾åƒ --</option>';
                
                if (structure.assets.images) {
                    structure.assets.images.forEach(img => {
                        const option = document.createElement('option');
                        option.value = `assets/images/${img}`;
                        option.textContent = img;
                        i2vSelect.appendChild(option);
                    });
                }
                
                // ä¹Ÿæ·»åŠ è¾“å‡ºçš„å‚è€ƒå›¾
                if (structure.outputs.references) {
                    structure.outputs.references.forEach(img => {
                        const option = document.createElement('option');
                        option.value = `outputs/references/${img}`;
                        option.textContent = `[è¾“å‡º] ${img}`;
                        i2vSelect.appendChild(option);
                    });
                }
            }
            
            // æ›´æ–°é¦–å°¾å¸§çš„å›¾ç‰‡é€‰æ‹©
            const kfFirstSelect = document.getElementById('kf-first');
            const kfLastSelect = document.getElementById('kf-last');
            
            if (kfFirstSelect && kfLastSelect) {
                kfFirstSelect.innerHTML = '<option value="">-- é€‰æ‹©é¦–å¸§ --</option>';
                kfLastSelect.innerHTML = '<option value="">-- é€‰æ‹©å°¾å¸§ --</option>';
                
                if (structure.assets.images) {
                    structure.assets.images.forEach(img => {
                        const firstOption = document.createElement('option');
                        firstOption.value = `assets/images/${img}`;
                        firstOption.textContent = img;
                        kfFirstSelect.appendChild(firstOption);
                        
                        const lastOption = document.createElement('option');
                        lastOption.value = `assets/images/${img}`;
                        lastOption.textContent = img;
                        kfLastSelect.appendChild(lastOption);
                    });
                }
                
                if (structure.outputs.references) {
                    structure.outputs.references.forEach(img => {
                        const firstOption = document.createElement('option');
                        firstOption.value = `outputs/references/${img}`;
                        firstOption.textContent = `[è¾“å‡º] ${img}`;
                        kfFirstSelect.appendChild(firstOption);
                        
                        const lastOption = document.createElement('option');
                        lastOption.value = `outputs/references/${img}`;
                        lastOption.textContent = `[è¾“å‡º] ${img}`;
                        kfLastSelect.appendChild(lastOption);
                    });
                }
            }
            
            // æ›´æ–°å›¾ç‰‡ç¼–è¾‘çš„é€‰æ‹©
            const editSelect = document.getElementById('edit-image');
            if (editSelect) {
                editSelect.innerHTML = '<option value="">-- é€‰æ‹©è¦ç¼–è¾‘çš„å›¾åƒ --</option>';
                
                if (structure.assets.images) {
                    structure.assets.images.forEach(img => {
                        const option = document.createElement('option');
                        option.value = `assets/images/${img}`;
                        option.textContent = img;
                        editSelect.appendChild(option);
                    });
                }
                
                if (structure.outputs.references) {
                    structure.outputs.references.forEach(img => {
                        const option = document.createElement('option');
                        option.value = `outputs/references/${img}`;
                        option.textContent = `[è¾“å‡º] ${img}`;
                        editSelect.appendChild(option);
                    });
                }
            }
        }
        
        // æ ¹æ®æ¨¡å‹ç±»å‹æ›´æ–°æ–‡ç”Ÿè§†é¢‘åˆ†è¾¨ç‡é€‰é¡¹
        function updateT2VResolutions(modelType) {
            const resolutionSelect = document.getElementById('t2v-resolution');
            
            if (modelType === 'local') {
                // æœ¬åœ°æ¨¡å‹ï¼š64çš„å€æ•°
                resolutionSelect.innerHTML = `
                    <option value="1024*1024" selected>1024Ã—1024 (1:1)</option>
                    <option value="1280*704">1280Ã—704 (16:9)</option>
                    <option value="704*1280">704Ã—1280 (9:16)</option>
                    <option value="1152*896">1152Ã—896 (4:3)</option>
                    <option value="896*1152">896Ã—1152 (3:4)</option>
                    <option value="1344*768">1344Ã—768 (7:4)</option>
                    <option value="768*1344">768Ã—1344 (4:7)</option>
                `;
            } else {
                // åœ¨çº¿æ¨¡å‹ï¼šé€šä¹‰ä¸‡ç›¸çš„æ ‡å‡†åˆ†è¾¨ç‡
                resolutionSelect.innerHTML = `
                    <option value="1920*1080" selected>1920Ã—1080 (16:9)</option>
                    <option value="1080*1920">1080Ã—1920 (9:16)</option>
                    <option value="1280*720">1280Ã—720 (16:9)</option>
                    <option value="720*1280">720Ã—1280 (9:16)</option>
                    <option value="1024*1024">1024Ã—1024 (1:1)</option>
                `;
            }
        }
        
        // æ˜¾ç¤ºé‡å‘½åèœå•
        function showRenameMenu(event, projectId, filePath, fileName) {
            event.preventDefault();
            
            // ç§»é™¤å·²å­˜åœ¨çš„èœå•
            const existingMenu = document.querySelector('.rename-menu');
            if (existingMenu) {
                existingMenu.remove();
            }
            
            // åˆ›å»ºèœå•
            const menu = document.createElement('div');
            menu.className = 'rename-menu';
            menu.style.left = event.pageX + 'px';
            menu.style.top = event.pageY + 'px';
            
            const renameItem = document.createElement('div');
            renameItem.className = 'rename-menu-item';
            renameItem.textContent = 'é‡å‘½å';
            renameItem.onclick = () => {
                menu.remove();
                startRename(projectId, filePath, fileName);
            };
            
            const deleteItem = document.createElement('div');
            deleteItem.className = 'rename-menu-item';
            deleteItem.textContent = 'åˆ é™¤';
            deleteItem.style.color = '#ff6b6b';
            deleteItem.onclick = () => {
                menu.remove();
                startDelete(projectId, filePath, fileName);
            };
            
            menu.appendChild(renameItem);
            menu.appendChild(deleteItem);
            document.body.appendChild(menu);
            
            // ç‚¹å‡»å…¶ä»–åœ°æ–¹å…³é—­èœå•
            setTimeout(() => {
                document.addEventListener('click', function closeMenu() {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                });
            }, 10);
        }
        
        // å¼€å§‹é‡å‘½å
        function startRename(projectId, filePath, fileName) {
            const newName = prompt('è¯·è¾“å…¥æ–°çš„æ–‡ä»¶åï¼š', fileName);
            if (newName && newName !== fileName && newName.trim() !== '') {
                renameFile(projectId, filePath, newName.trim());
            }
        }
        
        // é‡å‘½åæ–‡ä»¶
        function renameFile(projectId, oldPath, newName) {
            document.getElementById('statusText').innerHTML = `é‡å‘½åæ–‡ä»¶ä¸­...<span class="loading"></span>`;
            
            fetch(`/api/projects/${projectId}/rename`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    old_path: oldPath,
                    new_name: newName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('statusText').textContent = 'é‡å‘½åæˆåŠŸ';
                    loadProjectStructure(projectId); // åˆ·æ–°é¡¹ç›®ç»“æ„
                    if (document.getElementById('assets-panel').classList.contains('active')) {
                        loadAssets(); // åˆ·æ–°ç´ æé¢æ¿
                    }
                } else {
                    alert('é‡å‘½åå¤±è´¥: ' + data.error);
                    document.getElementById('statusText').textContent = 'é‡å‘½åå¤±è´¥';
                }
            })
            .catch(error => {
                alert('é‡å‘½åé”™è¯¯: ' + error);
                document.getElementById('statusText').textContent = 'é‡å‘½åé”™è¯¯';
            });
        }
        
        // å¼€å§‹åˆ é™¤
        function startDelete(projectId, filePath, fileName) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤æ–‡ä»¶ "${fileName}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`)) {
                deleteFile(projectId, filePath, fileName);
            }
        }
        
        // åˆ é™¤æ–‡ä»¶
        function deleteFile(projectId, filePath, fileName) {
            document.getElementById('statusText').innerHTML = `åˆ é™¤æ–‡ä»¶ä¸­...<span class="loading"></span>`;
            
            fetch(`/api/projects/${projectId}/delete`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    file_path: filePath
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('statusText').textContent = 'åˆ é™¤æˆåŠŸ';
                    loadProjectStructure(projectId); // åˆ·æ–°é¡¹ç›®ç»“æ„
                    if (document.getElementById('assets-panel').classList.contains('active')) {
                        loadAssets(); // åˆ·æ–°ç´ æé¢æ¿
                    }
                    // å¦‚æœå½“å‰é¢„è§ˆçš„æ˜¯è¢«åˆ é™¤çš„æ–‡ä»¶ï¼Œæ¸…ç©ºé¢„è§ˆ
                    const previewContent = document.getElementById('previewContent');
                    if (previewContent.innerHTML.includes(fileName)) {
                        previewContent.innerHTML = '<div class="preview-empty">æ–‡ä»¶å·²åˆ é™¤</div>';
                    }
                } else {
                    alert('åˆ é™¤å¤±è´¥: ' + data.error);
                    document.getElementById('statusText').textContent = 'åˆ é™¤å¤±è´¥';
                }
            })
            .catch(error => {
                alert('åˆ é™¤é”™è¯¯: ' + error);
                document.getElementById('statusText').textContent = 'åˆ é™¤é”™è¯¯';
            });
        }
        
        // åˆ‡æ¢å­æ ‡ç­¾
        function switchSubTab(type, tab) {
            // æ›´æ–°æ ‡ç­¾çŠ¶æ€
            const container = event.currentTarget.parentElement;
            container.querySelectorAll('.sub-tab').forEach(t => t.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            // åˆ‡æ¢å†…å®¹
            const contentClass = type === 'agent' ? 'agent-content' : 'model-content';
            document.querySelectorAll(`.${contentClass}`).forEach(c => c.style.display = 'none');
            document.getElementById(`${type}-${tab}`).style.display = 'block';
        }
        
        // é€‰æ‹©æ¨¡å‹
        function selectModel(type, model, element) {
            selectedModels[type] = model;
            element.parentElement.querySelectorAll('.model-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            element.classList.add('selected');
        }
        
        // æ‰§è¡ŒAgent
        function executeAgent(agentType) {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                return;
            }
            
            let inputData = {};
            
            if (agentType === 'story') {
                const story = document.getElementById('storyInput').value;
                if (!story) {
                    alert('è¯·è¾“å…¥æ•…äº‹å†…å®¹');
                    return;
                }
                inputData = { story };
            } else if (agentType === 'storyboard') {
                const select = document.getElementById('storyAnalysisSelect');
                if (!select.value) {
                    alert('è¯·é€‰æ‹©æ•…äº‹åˆ†æç»“æœ');
                    return;
                }
                inputData = { story_analysis: JSON.parse(select.value) };
            } else if (agentType === 'character') {
                const select = document.getElementById('storyAnalysisForCharacter');
                if (!select.value) {
                    alert('è¯·é€‰æ‹©æ•…äº‹åˆ†æç»“æœ');
                    return;
                }
                inputData = { story_analysis: JSON.parse(select.value) };
            }
            
            document.getElementById('statusText').innerHTML = `æ‰§è¡Œ${agentType} Agentä¸­...<span class="loading"></span>`;
            
            fetch(`/api/agents/${agentType}/execute`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    project_id: currentProject.id,
                    input_data: inputData,
                    save_result: true
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('statusText').textContent = 'Agentæ‰§è¡ŒæˆåŠŸ';
                    
                    // æ˜¾ç¤ºç»“æœ
                    const resultDiv = document.getElementById(`${agentType}Result`);
                    resultDiv.style.display = 'block';
                    resultDiv.querySelector('pre').textContent = JSON.stringify(data.result, null, 2);
                    
                    // åœ¨é¢„è§ˆé¢æ¿æ˜¾ç¤º
                    const previewContent = document.getElementById('previewContent');
                    previewContent.innerHTML = `
                        <div class="preview-title">Agentæ‰§è¡Œç»“æœ</div>
                        <div class="preview-meta">${agentType} Agent</div>
                        <div class="preview-json">${JSON.stringify(data.result, null, 2)}</div>
                    `;
                    
                    // åˆ·æ–°é¡¹ç›®ç»“æ„
                    loadProjectStructure(currentProject.id);
                    loadAvailablePrompts();
                } else {
                    alert('æ‰§è¡Œå¤±è´¥: ' + data.error);
                    document.getElementById('statusText').textContent = 'æ‰§è¡Œå¤±è´¥';
                }
            });
        }
        
        // ç”Ÿæˆå†…å®¹
        function generateContent(taskType) {
            if (!currentProject) {
                alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªé¡¹ç›®');
                return;
            }
            
            let params = {
                project_id: currentProject.id
            };
            
            if (taskType === 'text-to-image') {
                params.prompt = document.getElementById('t2i-prompt').value;
                params.negative_prompt = document.getElementById('t2i-negative').value;
                params.size = document.getElementById('t2i-size').value;
                params.style = document.getElementById('t2i-style').value;
                if (!params.prompt) {
                    alert('è¯·è¾“å…¥Prompt');
                    return;
                }
            } else if (taskType === 'image-to-video') {
                params.image_path = document.getElementById('i2v-image').value;
                params.prompt = document.getElementById('i2v-prompt').value;
                params.negative_prompt = document.getElementById('i2v-negative').value;
                params.resolution = document.getElementById('i2v-resolution').value;
                params.duration = parseInt(document.getElementById('i2v-duration').value);
                params.fps = 30;
                if (!params.image_path) {
                    alert('è¯·é€‰æ‹©å›¾åƒ');
                    return;
                }
            } else if (taskType === 'text-to-video') {
                params.model = selectedModels['t2v'];
                params.prompt = document.getElementById('t2v-prompt').value;
                params.negative_prompt = document.getElementById('t2v-negative').value;
                params.resolution = document.getElementById('t2v-resolution').value;
                params.duration = parseInt(document.getElementById('t2v-duration').value);
                params.fps = 30;
                params.style = document.getElementById('t2v-style').value;
                params.motion_strength = parseFloat(document.getElementById('t2v-motion').value);
                if (!params.prompt) {
                    alert('è¯·è¾“å…¥Prompt');
                    return;
                }
            } else if (taskType === 'keyframe-video') {
                params.first_frame_path = document.getElementById('kf-first').value;
                params.last_frame_path = document.getElementById('kf-last').value;
                params.prompt = document.getElementById('kf-prompt').value;
                if (!params.first_frame_path || !params.last_frame_path) {
                    alert('è¯·é€‰æ‹©é¦–å°¾å¸§å›¾åƒ');
                    return;
                }
            } else if (taskType === 'image-edit') {
                params.image_path = document.getElementById('edit-image').value;
                params.edit_instruction = document.getElementById('edit-instruction').value;
                if (!params.image_path || !params.edit_instruction) {
                    alert('è¯·é€‰æ‹©å›¾åƒå¹¶è¾“å…¥ç¼–è¾‘æŒ‡ä»¤');
                    return;
                }
            }
            
            document.getElementById('statusText').innerHTML = `ç”Ÿæˆ${taskType}ä¸­...<span class="loading"></span>`;
            
            fetch(`/api/generate/${taskType}`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(params)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('statusText').textContent = 'ç”ŸæˆæˆåŠŸ';
                    
                    // é¢„è§ˆç”Ÿæˆçš„å†…å®¹
                    const previewContent = document.getElementById('previewContent');
                    if (taskType.includes('image') || taskType === 'text-to-image') {
                        previewContent.innerHTML = `
                            <div class="preview-title">ç”Ÿæˆç»“æœ</div>
                            <div class="preview-meta">æ¨¡å‹: ${data.model_used}</div>
                            <img src="/${data.result_path}" class="preview-image" />
                        `;
                    } else {
                        previewContent.innerHTML = `
                            <div class="preview-title">ç”Ÿæˆç»“æœ</div>
                            <div class="preview-meta">æ¨¡å‹: ${data.model_used}</div>
                            <video src="/${data.result_path}" class="preview-video" controls></video>
                        `;
                    }
                    
                    // åˆ·æ–°é¡¹ç›®ç»“æ„
                    loadProjectStructure(currentProject.id);
                } else {
                    alert('ç”Ÿæˆå¤±è´¥: ' + data.error);
                    document.getElementById('statusText').textContent = 'ç”Ÿæˆå¤±è´¥';
                }
            });
        }
    </script>
</body>
</html>